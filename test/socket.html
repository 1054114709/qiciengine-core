<!DOCTYPE html>
<html>
<head>
    <title>Socket(GS)</title>
    <meta charset="UTF-8">

    <style type="text/css">
        div { padding: 10px; font-size: 1.5em; }
    </style>

    <script src="js/socket.io.js" type="text/javascript"></script>
    <script src="../lib/phaser.js" type="text/javascript"></script>
    <script src="../build/qc-core-debug.js" type="text/javascript"></script>
</head>
<body>
<script type="application/javascript" src="js/builtinStartGame.js"></script>

<script>
    var Assets = qc.Assets;
    var UIButton = qc.Button;
    var Transition = qc.Transition;
    var State = qc.UIState;
    game._onFirstScenePreload = function() {
        game.assets.load('monsters', 'assets/sprites/pixi_monsters.bin');
        game.assets.load('ui', 'assets/sprites/ui.bin');
    }

    game._onFirstSceneLoaded = function() {
        // 使用颜色变换
        button2 = game.add.button();
        button2.texture = game.assets.find('ui');
        button2.text.text = '[#ffffff]连接服务器[-]';
        button2.frame = 'buttonBackground.png';
        button2.normalColor = 0xffffff;
        button2.pressedTexture = 0x000000;
        button2.disabledTexture = 0xff0000;
        button2.transition = Transition.COLOR_TINT;
        button2.x = 200;
        button2.y = 200;
        button2.onClick.add(function() {
            game.gs.connect('http://127.0.0.1:8900/');
        });

        clue = game.add.text();
        clue.x = 50;
        clue.y = 300;
        clue.text = '';
        game.gs.onConnected.add(function() {
            clue.text = '连接服务器成功。';

            // 定期发送TEST请求
            game.timer.loop(2000, function() {
                game.gs.sendMessage('TEST', { msg : '你好，服务器' });
            });
        });

        // TEST的处理器
        game.gs.registerCmd({
            name : 'TEST',
            main : function(data) {
                console.log('Test消息：' + data.msg);
            }
        });
    }
</script>
</body>
</html>
