<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>孩子层次测试</title>
    <script src="../../lib/phaser.js" type="text/javascript"></script>
    <script src="../../build/qc-core-debug.js" type="text/javascript"></script>
    <script src="../../lib/qc-widget.js" type="text/javascript"></script>
    <script src="../GameView.js" type="text/javascript"></script>
    <script src="../GameData.js" type="text/javascript"></script>
    <script src="../GameTree.js" type="text/javascript"></script>
    <script src="../GameTable.js" type="text/javascript"></script>

    <script>
        allConf = {
            'daozei': {
                'url' : '../assets/dragonbones/daozei.bin',
                'x' : 80,
                'y' : 120
            }
        };
        function init() {
            game = new qc.Game(800, 600, "", {
                init: function() {
                    world = game.world;
                    tree = new GameTree(game);
                    table = new GameTable(tree.dataModel);
                    gameView = new GameView(game);

                    widthText = new qc.widget.TextField();
                    widthText.value = '500';

                    heightText = new qc.widget.TextField();
                    heightText.value = '300';

                    toggleButton = new qc.widget.ToggleButton();
                    toggleButton.text = '缩放显示';
                    toggleButton.on('click', function() {
                        var size = {width: parseInt(widthText.value), height: parseInt(heightText.value)};
                        gameView.size = toggleButton.selected ? size : null;
                    });

                    var button = new qc.widget.Button();
                    button.text = '测试';
                    button.on('click', function() {
                        alert('测试');
                    });

                    toolbar = new qc.widget.Toolbar();
                    toolbar.setItems([widthText, heightText, toggleButton, button]);

                    container = new qc.widget.Container();
                    container.layout = new qc.widget.layout.BorderLayout(container);
                    container.setItems([
                        {
                            region: 'top',
                            element: toolbar
                        },
                        {
                            region: 'left',
                            element: tree,
                            width: 200
                        },
                        {
                            region: 'center',
                            element: gameView
                        },
                        {
                            region: 'right',
                            element: table,
                            width: 200
                        }
                    ]);
                    container.addToDOM();
                },
                preload: function() {
                    game.assets.load('sencha', 'sencha.bin');
                    game.assets.load('circle', 'circle.bin');
                    game.assets.load('h5', 'h5.bin');
                    game.assets.load('pentagon', 'pentagon.bin');
                    game.assets.load('square', 'square.bin');
                    game.stage.backgroundColor = '0x3498db'
                    for (var key in allConf) {
                        game.assets.load(key, allConf[key].url);
                    }
                },
                create: function() {
                    sencha = createImage('sencha', null, 300, 20);
                    circle = createImage('circle', sencha);
                    pentagon = createImage('pentagon', sencha, 60, 60);
                    square = createImage('square');
                    h5 = createImage('h5', square, 30, 20);

                    allAni = [];
                    for (var name in allConf) {
                        conf = allConf[name];
                        ob = new qc.Sprite(game);
                        ob.x = conf.x;
                        ob.y = conf.y;
                        ob.name = name;
                        ob.texture = game.assets.find(name);
                        allAni.push(ob);
                    }

                    tree.expandAll();

                },
                update: function() {
                    table.iv();

                    allAni.forEach(function(ob) {
                        var list = ob.animationNameList;
                        if (!list)
                            return;

                        if (!ob.countFrame) {
                            ob.countFrame = 1;
                            ob.playAnimation(list[parseInt(Math.random() * list.length)]);
                        } else {
                            ob.countFrame++;
                            if (ob.countFrame % 100 == 0)
                                ob.playAnimation(list[parseInt(Math.random() * list.length)]);
                        }
                    });
                }
            });
        }

        function createImage(texture, parent, x, y) {
            var image = new qc.UIImage(game);
            image.interactive = true;
            image.texture = game.assets.find(texture);
            image.name = texture;
            image.x = x || 0;
            image.y = y || 0;
            if (parent) {
                parent.addChild(image);
            }
            image.resetNativeSize();
            return image;
        }
    </script>
</head>
<body onload="init();">

</body>
</html>